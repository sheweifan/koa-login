<%- include('../layout_header') %>


<div id="login" style="display:none;">
	登陆
	<input type="text" id="name" placeholder="名称" />
	<input type="text" id="password" placeholder="密码" />
	<a href="javascript:" id="submit">确定</a>
</div>

<div id="register">
	注册
	<input type="text" id="name2" placeholder="名称" />
	<input type="text" id="password2" placeholder="密码" />
	<a href="javascript:" id="register_btn">确定</a>
</div>

<div id="logined" style="display:none">
	<span id="username"></span>
	<a href="javascript:" id="loginout">退出登陆</a>
</div>
<a href="/test">test</a>
<%- include('../layout_scripts') %>

<script type="text/javascript">

	$.ajax('/islogined',{
		success:function(data){
			if(data){
				$('#logined').show().find('#username').html(data.name)
			}else{
				$('#login').show();
			}
		}
	})

	$('#submit').on('click',function(){
		var name = $('#name').val();
		var password = $('#password').val();
		// console.log(name,password)
		$.ajax('/login',{
			type:'POST',
			dataType:'json',
			data:{
				name:name,
				password:password
			},
			success:function(data){
				// console.log(data);
				if(data.compare){
					$('#login').hide();
					$('#logined').show().find('#username').html(data.name)
				}else{
					alert('账号或密码错误')
				}
			}
		})
	});

	$('#loginout').on('click',function(){
		$.ajax('/logout',{
			success:function(data){
				if(data){
					$('#login').show();
					$('#logined').hide();
				}
			}
		})
	})

	$('#register_btn').on('click',function(){
		var name = $('#name2').val();
		var password = $('#password2').val();
		// console.log(name,password)
		$.ajax('/register',{
			type:'POST',
			dataType:'json',
			data:{
				name:name,
				password:password
			},
			success:function(data){
				// console.log(data);
				if(data.success){
					console.log('登陆成功');
					$('#login').hide();
					$('#logined').show().find('#username').html($('#name2').val())
				}else{
					if(data.repeat){
						alert('用户名已被注册')
					}else{
						alert('存储失败，请稍后重试')
					}
				}
				// if(data.compare){
				// 	$('#login').hide();
				// 	$('#logined').show().find('.username').html(data.name)
				// }else{
				// 	alert('账号或密码错误')
				// }
			}
		})
	})
</script>
<%- include('../layout_footer') %>